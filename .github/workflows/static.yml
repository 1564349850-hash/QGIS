<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="stylesheet" href="./resources/ol.css">
    <link rel="stylesheet" href="resources/fontawesome-all.min.css">
    <link href="resources/photon-geocoder-autocomplete.min.css" rel="stylesheet">
    <link rel="stylesheet" href="./resources/ol-layerswitcher.css">
    <link rel="stylesheet" href="./resources/qgis2web.css">
    <style>
        html, body {
            background-color: #ffffff;
        }
        /* 核心控件样式：移除黄色，统一风格 */
        .ol-control > * {
            background-color: #f8f8f8 !important;
            color: #444444 !important;
            border-radius: 0px;
            border: none !important;
        }

        .ol-attribution a, .gcd-gl-input::placeholder, .search-layer-input-search::placeholder {
            color: #444444 !important;
        }

        .search-layer-input-search {
            background-color: #f8f8f8 !important;
        }

        .ol-control > *:focus,
        .ol-control > *:hover,
        .measure-btn:hover,
        .measure-btn.active,
        #feature-search-btn:hover {
            background-color: rgba(248, 248, 248, 0.7) !important;
            color: #444444 !important;
            outline: none !important;
            box-shadow: none !important;
        }

        .ol-control {
            background-color: rgba(255,255,255,.4) !important;
            padding: 2px !important;
            border: none !important;
        }

        /* 要素搜索框：左上 */
        #feature-search-container {
            position: absolute;
            top: 15px;
            left: 70px;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 5px;
            background: #f8f8f8;
            padding: 5px;
            border: 1px solid #ddd;
        }

        #feature-search-input {
            height: 30px;
            padding: 0 8px;
            border: 1px solid #ddd;
            background: #fff;
            color: #444;
            width: 250px;
            outline: none;
        }

        #feature-search-btn {
            height: 30px;
            padding: 0 12px;
            background: #f8f8f8;
            color: #444;
            border: 1px solid #ddd;
            cursor: pointer;
        }

        #search-results {
            position: absolute;
            top: 55px;
            left: 70px;
            z-index: 1000;
            background: #fff;
            border: 1px solid #ddd;
            width: 300px;
            max-height: 200px;
            overflow-y: auto;
            display: none;
        }

        .search-result-item {
            padding: 8px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
        }

            .search-result-item:hover {
                background: #f8f8f8;
                color: #444;
            }

        /* 要素高亮样式（仅搜索结果使用，非悬停） */
        .feature-highlight {
            stroke: #ff0000;
            stroke-width: 3;
            fill: rgba(255, 0, 0, 0.2);
        }

        /* 距离测量：右上 */
        #measure-container {
            position: absolute;
            top: 15px;
            right: 15px;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 5px;
            background: #f8f8f8;
            padding: 5px;
            border: 1px solid #ddd;
        }

        .measure-btn {
            height: 30px;
            padding: 0 12px;
            background: #f8f8f8;
            color: #444;
            border: 1px solid #ddd;
            cursor: pointer;
        }

        #measure-result {
            position: absolute;
            top: 55px;
            right: 15px;
            z-index: 1000;
            background: #fff;
            border: 1px solid #ddd;
            padding: 8px 12px;
            min-width: 150px;
            display: none;
            color: #444;
        }

        /* 测量绘制样式 */
        .measure-line {
            stroke: #0066ff;
            stroke-width: 2;
            stroke-dasharray: 5,5;
            fill: none;
        }

        .measure-point {
            stroke: #0066ff;
            stroke-width: 2;
            fill: #ffffff;
        }

        /* 弹窗样式：复用单例 */
        .ol-popup {
            position: absolute;
            background-color: white;
            box-shadow: 0 1px 4px rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #cccccc;
            bottom: 12px;
            left: -50px;
            min-width: 280px;
            display: none; /* 默认隐藏 */
        }

            .ol-popup:after, .ol-popup:before {
                top: 100%;
                border: solid transparent;
                content: " ";
                height: 0;
                width: 0;
                position: absolute;
                pointer-events: none;
            }

            .ol-popup:after {
                border-top-color: white;
                border-width: 10px;
                left: 48px;
                margin-left: -10px;
            }

            .ol-popup:before {
                border-top-color: #cccccc;
                border-width: 11px;
                left: 48px;
                margin-left: -11px;
            }

        .ol-popup-closer {
            text-decoration: none;
            position: absolute;
            top: 2px;
            right: 8px;
            color: #444;
            cursor: pointer;
        }

            .ol-popup-closer:after {
                content: "✖";
                color: #444;
            }

        #popup-content {
            color: #444;
        }

        /* ========== 核心修改1：彻底禁用面图层的悬停高亮（全场景覆盖） ========== */
        /* 覆盖所有要素（含面）的悬停样式，强制继承原始样式 */
        .ol-feature,
        .ol-feature:hover,
        .ol-selectable,
        .ol-selectable:hover,
        /* 针对面要素的特定样式覆盖 */
        .ol-layer-vector .ol-feature.ol-polygon,
        .ol-layer-vector .ol-feature.ol-polygon:hover {
            stroke: inherit !important;
            stroke-width: inherit !important;
            fill: inherit !important;
            fill-opacity: inherit !important;
            cursor: pointer !important;
            /* 禁止任何默认高亮效果 */
            filter: none !important;
            opacity: inherit !important;
        }

        /* ========== 新增：悬停提示弹窗样式（仅显示信息，无样式变化） ========== */
        #hover-tooltip {
            position: absolute;
            background: #f8f8f8;
            padding: 6px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 12px;
            color: #444;
            pointer-events: none; /* 不阻挡鼠标事件 */
            z-index: 1001; /* 高于其他面板 */
            display: none;
            white-space: nowrap; /* 防止文字换行 */
        }

        /* ========== 信息面板样式（保留你的原有布局） ========== */
        #title-panel {
            position: absolute;
            top: 15px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            background: #f8f8f8;
            padding: 8px 20px;
            border: 1px solid #ddd;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            color: #444;
            min-width: 300px;
        }

        #research-panel {
            position: absolute;
            bottom: 15px;
            left: 15px;
            z-index: 1000;
            background: #f8f8f8;
            padding: 10px 15px;
            border: 1px solid #ddd;
            color: #444;
            max-width: 300px;
        }

            #research-panel h4 {
                margin: 0 0 8px 0;
                font-size: 16px;
                border-bottom: 1px solid #eee;
                padding-bottom: 5px;
            }

            #research-panel p {
                margin: 4px 0;
                font-size: 14px;
                line-height: 1.4;
            }

        #info-panel {
            position: absolute;
            bottom: 15px;
            right: 15px;
            z-index: 1000;
            background: #f8f8f8;
            padding: 10px 15px;
            border: 1px solid #ddd;
            color: #444;
            max-width: 280px;
            font-size: 14px;
            line-height: 1.5;
        }

            #info-panel a {
                color: #0066ff;
                text-decoration: none;
            }

                #info-panel a:hover {
                    text-decoration: underline;
                }

        #tips-panel {
            position: absolute;
            top: 60px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            background: #f8f8f8;
            padding: 8px 15px;
            border: 1px solid #ddd;
            color: #444;
            font-size: 13px;
            line-height: 1.5;
            min-width: 400px;
            text-align: center;
        }

        html, body, #map {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
        }
    </style>
    <title>GIS要素搜索与距离测量</title>
</head>
<body>
    <div id="map">
        <div id="popup" class="ol-popup">
            <div id="popup-closer" class="ol-popup-closer"></div>
            <div id="popup-content"></div>
        </div>

        <!-- 悬停提示弹窗 -->
        <div id="hover-tooltip"></div>

        <!-- 要素搜索 -->
        <div id="feature-search-container">
            <input type="text" id="feature-search-input" placeholder="搜索所有要素（任意属性）...">
            <button id="feature-search-btn">搜索</button>
        </div>
        <div id="search-results"></div>
        <!-- 距离测量 -->
        <div id="measure-container">
            <button id="measure-distance-btn" class="measure-btn">开始测距</button>
            <button id="measure-clear-btn" class="measure-btn">清除测量</button>
        </div>
        <div id="measure-result">总距离：0 米</div>

        <!-- 信息面板 -->
        <div id="title-panel">新疆维吾尔自治区路线图</div>
        <div id="tips-panel">
            使用提示：在搜索之后点击结果，搜索的结果会放大变红；测量距离时，先点击测量距离，之后点击两个地方，右上角会显示距离；不想测距时，点击清除测量
        </div>
        <div id="research-panel">
            <h4>研究说明</h4>
            <p><strong>研究目的：</strong>研究新疆的路线分布</p>
            <p><strong>研究目标：</strong>寻找出发地点与到达地点的距离与可行路线</p>
        </div>
        <div id="info-panel">
            地图由中国石油大学（华东）赵西峥制作<br>
            数据来源：<a href="https://www.tianditu.gov.cn/" target="_blank">天地图（https://www.tianditu.gov.cn/）</a>
        </div>
    </div>

    <script src="resources/qgis2web_expressions.js"></script>
    <script src="resources/proj4.js"></script>
    <script>proj4.defs('EPSG:4326','+proj=longlat +datum=WGS84 +no_defs');</script>
    <script src="./resources/functions.js"></script>
    <script src="./resources/ol.js"></script>
    <script src="./resources/ol-layerswitcher.js"></script>
    <script src="resources/photon-geocoder-autocomplete.min.js"></script>
    <!-- 图层和样式脚本（保持原有） -->
    <script src="layers/__2.js"></script>
    <script src="layers/__3.js"></script>
    <script src="layers/__4.js"></script>
    <script src="layers/__5.js"></script>
    <script src="layers/__6.js"></script>
    <script src="layers/__7.js"></script>
    <script src="layers/__8.js"></script>
    <script src="layers/__9.js"></script>
    <script src="layers/__10.js"></script>
    <script src="layers/__11.js"></script>
    <script src="layers/__12.js"></script>
    <script src="layers/__13.js"></script>
    <script src="layers/__14.js"></script>
    <script src="layers/__15.js"></script>
    <script src="layers/__16.js"></script>
    <script src="layers/__17.js"></script>
    <script src="layers/__18.js"></script>
    <script src="layers/__19.js"></script>
    <script src="layers/__20.js"></script>
    <script src="layers/__21.js"></script>
    <script src="layers/__22.js"></script>
    <script src="layers/__23.js"></script>
    <script src="layers/__24.js"></script>
    <script src="layers/__25.js"></script>
    <script src="layers/__26.js"></script>
    <script src="layers/__27.js"></script>
    <script src="layers/_28.js"></script>
    <script src="layers/_29.js"></script>
    <script src="layers/_30.js"></script>
    <script src="layers/_31.js"></script>
    <script src="styles/__2_style.js"></script>
    <script src="styles/__3_style.js"></script>
    <script src="styles/__4_style.js"></script>
    <script src="styles/__5_style.js"></script>
    <script src="styles/__6_style.js"></script>
    <script src="styles/__7_style.js"></script>
    <script src="styles/__8_style.js"></script>
    <script src="styles/__9_style.js"></script>
    <script src="styles/__10_style.js"></script>
    <script src="styles/__11_style.js"></script>
    <script src="styles/__12_style.js"></script>
    <script src="styles/__13_style.js"></script>
    <script src="styles/__14_style.js"></script>
    <script src="styles/__15_style.js"></script>
    <script src="styles/__16_style.js"></script>
    <script src="styles/__17_style.js"></script>
    <script src="styles/__18_style.js"></script>
    <script src="styles/__19_style.js"></script>
    <script src="styles/__20_style.js"></script>
    <script src="styles/__21_style.js"></script>
    <script src="styles/__22_style.js"></script>
    <script src="styles/__23_style.js"></script>
    <script src="styles/__24_style.js"></script>
    <script src="styles/__25_style.js"></script>
    <script src="styles/__26_style.js"></script>
    <script src="styles/__27_style.js"></script>
    <script src="styles/_28_style.js"></script>
    <script src="styles/_29_style.js"></script>
    <script src="styles/_30_style.js"></script>
    <script src="styles/_31_style.js"></script>
    <script src="./layers/layers.js" type="text/javascript"></script>
    <script src="./resources/Autolinker.min.js"></script>
    <script src="./resources/qgis2web.js"></script>

    <script>
        // 工具函数：节流
        function throttle(fn, delay = 100) {
        let timer = null;
        return function(...args) {
        if (!timer) {
        timer = setTimeout(() => {
        fn.apply(this, args);
        timer = null;
        }, delay);
        }
        };
        }

        // 工具函数：防抖
        function debounce(fn, delay = 300) {
        let timer = null;
        return function(...args) {
        clearTimeout(timer);
        timer = setTimeout(() => {
        fn.apply(this, args);
        }, delay);
        };
        }

        window.addEventListener('load', function() {
        const map = window.map;
        if (!map) {
        console.error('地图实例未找到！');
        return;
        }

        // 1. 全局缓存要素
        let allVectorFeatures = [];
        let vectorLayers = [];
        function initFeatureCache() {
        allVectorFeatures = [];
        vectorLayers = [];
        map.getLayers().forEach(layer => {
        if (layer instanceof ol.layer.Vector && layer.getVisible()) {
        vectorLayers.push(layer);
        const source = layer.getSource();
        if (source instanceof ol.source.Vector) {
        const features = source.getFeatures();
        features.forEach(feature => {
        feature.set('layerName', layer.get('name') || '未命名图层');
        allVectorFeatures.push(feature);
        });
        }
        }
        });
        }
        initFeatureCache();

        // 2. 单例图层/弹窗
        // 高亮图层（仅搜索结果）
        const highlightLayer = new ol.layer.Vector({
        source: new ol.source.Vector(),
        style: new ol.style.Style({
        stroke: new ol.style.Stroke({ color: '#ff0000', width: 3 }),
        fill: new ol.style.Fill({ color: 'rgba(255, 0, 0, 0.2)' }),
        image: new ol.style.Circle({
        radius: 8,
        stroke: new ol.style.Stroke({ color: '#ff0000', width: 2 }),
        fill: new ol.style.Fill({ color: 'rgba(255, 0, 0, 0.4)' })
        })
        }),
        zIndex: 9999
        });
        map.addLayer(highlightLayer);

        // 测量图层
        const measureLineStyle = new ol.style.Style({
        stroke: new ol.style.Stroke({ color: '#0066ff', width: 2, lineDash: [5, 5] })
        });
        const measurePointStyle = new ol.style.Style({
        image: new ol.style.Circle({
        radius: 5,
        stroke: new ol.style.Stroke({ color: '#0066ff', width: 2 }),
        fill: new ol.style.Fill({ color: '#ffffff' })
        })
        });
        const measureSource = new ol.source.Vector();
        const measureLayer = new ol.layer.Vector({
        source: measureSource,
        style: function(feature) {
        return feature.get('type') === 'line' ? measureLineStyle : measurePointStyle;
        },
        zIndex: 9998
        });
        map.addLayer(measureLayer);

        // 点击弹窗
        const popup = document.getElementById('popup');
        const popupContent = document.getElementById('popup-content');
        const popupCloser = document.getElementById('popup-closer');
        const popupOverlay = new ol.Overlay({
        element: popup,
        positioning: 'bottom-center',
        stopEvent: false,
        offset: [0, -10]
        });
        map.addOverlay(popupOverlay);
        popupCloser.addEventListener('click', function() {
        popupOverlay.setPosition(undefined);
        popup.style.display = 'none';
        });

        // ========== 核心修改2：悬停提示逻辑（仅显示信息，不改变面样式） ==========
        const hoverTooltip = document.getElementById('hover-tooltip');
        // 鼠标移动时检测面要素，显示提示
        map.on('pointermove', throttle(function(e) {
        if (measureActive) {
        hoverTooltip.style.display = 'none';
        map.getTargetElement().style.cursor = 'crosshair';
        return;
        }

        const pixel = map.getEventPixel(e.originalEvent);
        // 仅检测面要素（Polygon/MultiPolygon）
        const feature = map.forEachFeatureAtPixel(pixel, function(feature, layer) {
        const geom = feature.getGeometry();
        return (layer instanceof ol.layer.Vector &&
        (geom instanceof ol.geom.Polygon || geom instanceof ol.geom.MultiPolygon))
        ? feature : null;
        });

        if (feature) {
        // 提取面要素的关键信息（示例：取第一个非几何属性）
        const properties = feature.getProperties();
        let tipText = `${feature.get('layerName')}：`;
        let firstProp = '无属性信息';
        for (const [key, value] of Object.entries(properties)) {
        if (key !== 'geometry' && value) {
        firstProp = `${key}：${value}`;
        break;
        }
        }
        tipText += firstProp;

        // 设置提示位置和内容
        hoverTooltip.innerHTML = tipText;
        hoverTooltip.style.left = `${e.originalEvent.clientX + 10}px`;
        hoverTooltip.style.top = `${e.originalEvent.clientY + 10}px`;
        hoverTooltip.style.display = 'block';
        map.getTargetElement().style.cursor = 'pointer';
        } else {
        hoverTooltip.style.display = 'none';
        map.getTargetElement().style.cursor = '';
        }
        }, 50));

        // 3. 要素搜索功能
        const searchInput = document.getElementById('feature-search-input');
        const searchBtn = document.getElementById('feature-search-btn');
        const searchResults = document.getElementById('search-results');
        const searchFeatures = debounce(function(keyword) {
        if (!keyword.trim()) {
        searchResults.style.display = 'none';
        highlightLayer.getSource().clear();
        return;
        }
        keyword = keyword.toLowerCase().trim();
        const matchedFeatures = [];
        allVectorFeatures.forEach(feature => {
        const properties = feature.getProperties();
        for (const [key, value] of Object.entries(properties)) {
        if (key !== 'geometry' && value?.toString().toLowerCase().includes(keyword)) {
        matchedFeatures.push({ feature, layerName: feature.get('layerName'), matchKey: key, matchValue: value });
        break;
        }
        }
        });
        renderSearchResults(matchedFeatures);
        }, 300);
        function renderSearchResults(features) {
        searchResults.innerHTML = '';
        highlightLayer.getSource().clear();
        if (!features.length) {
        searchResults.innerHTML = '<div class="search-result-item">未找到匹配的要素</div>';
        searchResults.style.display = 'block';
        return;
        }
        const fragment = document.createDocumentFragment();
        features.forEach(item => {
        const resultItem = document.createElement('div');
        resultItem.className = 'search-result-item';
        resultItem.innerHTML = `<strong>${item.layerName}</strong><br>匹配字段: ${item.matchKey} = ${item.matchValue}`;
        resultItem.addEventListener('click', () => {
        highlightLayer.getSource().clear();
        highlightLayer.getSource().addFeature(item.feature);
        map.getView().fit(item.feature.getGeometry().getExtent(), { duration: 500, padding: [50, 50, 50, 50], maxZoom: 18 });
        searchResults.style.display = 'none';
        });
        fragment.appendChild(resultItem);
        });
        searchResults.appendChild(fragment);
        searchResults.style.display = 'block';
        }
        searchBtn.addEventListener('click', () => searchFeatures(searchInput.value));
        searchInput.addEventListener('input', () => searchFeatures(searchInput.value));
        document.addEventListener('click', (e) => {
        const container = document.getElementById('feature-search-container');
        if (!container.contains(e.target) && !searchResults.contains(e.target)) searchResults.style.display = 'none';
        });

        // 4. 距离测量功能（修复原错误）
        let measureActive = false;
        let measurePoints = [];
        const measureResultEl = document.getElementById('measure-result');
        function formatDistance(distance) {
        return distance >= 1000 ? (distance / 1000).toFixed(2) + ' 千米' : distance.toFixed(2) + ' 米';
        }
        // 修复原错误的距离计算函数
        function calculateDistance(coords1, coords2) {
        const proj = map.getView().getProjection();
        const lonlat1 = ol.proj.transform(coords1, proj, 'EPSG:4326');
        const lonlat2 = ol.proj.transform(coords2, proj, 'EPSG:4326');
        const R = 6371000;
        const lat1 = lonlat1[1] * Math.PI / 180;
        const lat2 = lonlat2[1] * Math.PI / 180;
        const dLat = lat2 - lat1;
        const dLon = (lonlat2[0] - lonlat1[0]) * Math.PI / 180;
        const a = Math.sin(dLat/2) * Math.sin(dLat/2) + Math.cos(lat1) * Math.cos(lat2) * Math.sin(dLon/2) * Math.sin(dLon/2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        return R * c;
        }
        function updateMeasureResult() {
        if (measurePoints.length < 2) {
        measureResultEl.innerHTML = '总距离：0 米';
        return;
        }
        let totalDistance = 0;
        for (let i = 0; i < measurePoints.length - 1; i++) {
        totalDistance += calculateDistance(measurePoints[i], measurePoints[i+1]);
        }
        measureResultEl.innerHTML = `总距离：${formatDistance(totalDistance)}`;
        }
        const drawMeasureLine = throttle(function() {
        measureSource.clear();
        const featuresToAdd = [];
        measurePoints.forEach(coord => {
        featuresToAdd.push(new ol.Feature({ geometry: new ol.geom.Point(coord), type: 'point' }));
        });
        if (measurePoints.length >= 2) {
        featuresToAdd.push(new ol.Feature({ geometry: new ol.geom.LineString(measurePoints), type: 'line' }));
        }
        measureSource.addFeatures(featuresToAdd);
        updateMeasureResult();
        }, 50);
        function startMeasure() {
        if (measureActive) return;
        measureActive = true;
        measurePoints = [];
        measureSource.clear();
        measureResultEl.style.display = 'block';
        document.getElementById('measure-distance-btn').classList.add('active');
        hoverTooltip.style.display = 'none';
        }
        function stopMeasure() {
        measureActive = false;
        document.getElementById('measure-distance-btn').classList.remove('active');
        }
        function clearMeasure() {
        stopMeasure();
        measurePoints = [];
        measureSource.clear();
        measureResultEl.style.display = 'none';
        measureResultEl.innerHTML = '总距离：0 米';
        }
        const handlePointerMove = throttle(function(e) {
        if (!measureActive || measurePoints.length === 0) return;
        const tempPoints = [...measurePoints, e.coordinate];
        measureSource.clear();
        const featuresToAdd = [];
        measurePoints.forEach(coord => {
        featuresToAdd.push(new ol.Feature({ geometry: new ol.geom.Point(coord), type: 'point' }));
        });
        featuresToAdd.push(new ol.Feature({ geometry: new ol.geom.LineString(tempPoints), type: 'line' }));
        measureSource.addFeatures(featuresToAdd);
        }, 30);

        // 5. 全局事件绑定
        map.on('click', function(e) {
        if (measureActive) {
        measurePoints.push(e.coordinate);
        drawMeasureLine();
        return;
        }
        const pixel = map.getEventPixel(e.originalEvent);
        const feature = map.forEachFeatureAtPixel(pixel, (feature, layer) => layer instanceof ol.layer.Vector ? feature : null);
        if (feature) {
        const properties = feature.getProperties();
        let content = '<table style="width:100%; border-collapse: collapse;">';
        for (const [key, value] of Object.entries(properties)) {
        if (key !== 'geometry') {
        content += `<tr style="border-bottom:1px solid #eee;"><<th style="text-align:left; padding:4px; color:#444;">${key}</</th><td style="padding:4px; color:#444;">${value || '-'}</td></tr>`;
        }
        }
        content += '</table>';
        popupContent.innerHTML = content;
        popup.style.display = 'block';
        popupOverlay.setPosition(e.coordinate);
        hoverTooltip.style.display = 'none';
        }
        });
        map.on('pointermove', handlePointerMove);
        document.getElementById('measure-distance-btn').addEventListener('click', () => measureActive ? stopMeasure() : startMeasure());
        document.getElementById('measure-clear-btn').addEventListener('click', clearMeasure);

        // 6. 内存优化
        window.addEventListener('beforeunload', function() {
        highlightLayer.getSource().clear();
        measureSource.clear();
        map.un('click');
        map.un('pointermove');
        allVectorFeatures = [];
        vectorLayers = [];
        });
        });
    </script>
</body>
</html>
